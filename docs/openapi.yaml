openapi: 3.0.3
info:
  title: Sense API
  description: |
    REST API для социальной сети Sense - платформы для творчества и обмена знаниями.
    
    API поддерживает:
    - Аутентификацию пользователей через JWT токены
    - Создание и управление публикациями (посты, статьи, цитаты)
    - Систему комментариев и лайков
    - Персонализированную ленту с рекомендациями на основе AI
    - Поиск контента и пользователей
    - Загрузку и управление медиа-файлами
    - Профили пользователей с различными ролями
  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

tags:
  - name: Auth
    description: Аутентификация и авторизация пользователей
  - name: Publications
    description: Управление публикациями (посты, статьи, цитаты)
  - name: Comments
    description: Система комментариев
  - name: Feed
    description: Лента публикаций и рекомендации
  - name: Profile
    description: Профили пользователей
  - name: Search
    description: Поиск контента и пользователей
  - name: Media
    description: Загрузка и управление медиа-файлами
  - name: AI
    description: AI-функции (рекомендации, модерация)

paths:
  # Аутентификация
  /auth/login:
    post:
      tags: [Auth]
      summary: Вход в систему
      description: Аутентификация пользователя по логину/email и паролю
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              login: "john_doe"
              password: "secure_password123"
      responses:
        '200':
          description: Успешная аутентификация
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'
              example:
                access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                token_type: "Bearer"
                expires_in: 3600
                user:
                  id: "123e4567-e89b-12d3-a456-426614174000"
                  username: "john_doe"
                  email: "john@example.com"
                  role: "user"
                  registered_at: "2024-01-15T10:30:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/register:
    post:
      tags: [Auth]
      summary: Регистрация нового пользователя
      description: Создание нового аккаунта пользователя
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              username: "john_doe"
              email: "john@example.com"
              password: "secure_password123"
              phone: "+375291234567"
              description: "Фотограф и дизайнер"
      responses:
        '201':
          description: Пользователь успешно зарегистрирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'
              example:
                access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                token_type: "Bearer"
                expires_in: 3600
                user:
                  id: "123e4567-e89b-12d3-a456-426614174000"
                  username: "john_doe"
                  email: "john@example.com"
                  role: "user"
                  registered_at: "2024-01-15T10:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Конфликт - пользователь уже существует
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "user_exists"
                message: "Пользователь с таким именем или email уже существует"
                details: "Попробуйте другой username или email"

  /auth/logout:
    post:
      tags: [Auth]
      summary: Выход из системы
      description: Инвалидация JWT токена пользователя
      responses:
        '200':
          description: Успешный выход
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Успешный выход из системы"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/check:
    get:
      tags: [Auth]
      summary: Проверка токена
      description: Проверка валидности текущего JWT токена
      responses:
        '200':
          description: Токен валиден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
              example:
                id: "123e4567-e89b-12d3-a456-426614174000"
                username: "john_doe"
                email: "john@example.com"
                role: "user"
                registered_at: "2024-01-15T10:30:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'

  # Публикации
  /publication/create:
    post:
      tags: [Publications]
      summary: Создать публикацию
      description: Создание новой публикации (пост, статья или цитата)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePublicationRequest'
            example:
              type: "post"
              content: "Сегодня был прекрасный закат в Минске!"
              visibility: "public"
              media_ids: ["123e4567-e89b-12d3-a456-426614174000"]
      responses:
        '201':
          description: Публикация успешно создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /publication/{id}:
    get:
      tags: [Publications]
      summary: Получить публикацию
      description: Получение информации о публикации по ID
      parameters:
        - $ref: '#/components/parameters/PublicationId'
      responses:
        '200':
          description: Информация о публикации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicationResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

    put:
      tags: [Publications]
      summary: Редактировать публикацию
      description: Обновление существующей публикации (только автор)
      parameters:
        - $ref: '#/components/parameters/PublicationId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePublicationRequest'
            example:
              content: "Обновленный текст публикации"
              visibility: "public"
      responses:
        '200':
          description: Публикация успешно обновлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Publications]
      summary: Удалить публикацию
      description: Удаление публикации (только автор)
      parameters:
        - $ref: '#/components/parameters/PublicationId'
      responses:
        '204':
          description: Публикация успешно удалена
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /publication/{id}/like:
    post:
      tags: [Publications]
      summary: Поставить лайк
      description: Поставить или убрать лайк с публикации
      parameters:
        - $ref: '#/components/parameters/PublicationId'
      responses:
        '200':
          description: Лайк успешно поставлен/убран
          content:
            application/json:
              schema:
                type: object
                properties:
                  liked:
                    type: boolean
                    description: Лайкнул ли пользователь публикацию
                    example: true
                  likes_count:
                    type: integer
                    description: Общее количество лайков
                    example: 26
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /publication/{id}/likes:
    get:
      tags: [Publications]
      summary: Получить список лайкнувших
      description: Получение списка пользователей, лайкнувших публикацию
      parameters:
        - $ref: '#/components/parameters/PublicationId'
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
      responses:
        '200':
          description: Список пользователей, лайкнувших публикацию
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  total:
                    type: integer
                    example: 25
                  limit:
                    type: integer
                    example: 20
                  offset:
                    type: integer
                    example: 0
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /publication/{id}/save:
    post:
      tags: [Publications]
      summary: Сохранить публикацию
      description: Добавить публикацию в сохраненные
      parameters:
        - $ref: '#/components/parameters/PublicationId'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                note:
                  type: string
                  maxLength: 500
                  description: Заметка к сохраненной публикации
                  example: "Интересная статья о фотографии"
      responses:
        '201':
          description: Публикация добавлена в сохраненные
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Публикация добавлена в сохраненные"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Publications]
      summary: Убрать из сохраненных
      description: Удалить публикацию из сохраненных
      parameters:
        - $ref: '#/components/parameters/PublicationId'
      responses:
        '204':
          description: Публикация удалена из сохраненных
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Комментарии
  /publication/{id}/comments:
    get:
      tags: [Comments]
      summary: Получить комментарии публикации
      description: Получение списка комментариев к публикации с пагинацией
      parameters:
        - $ref: '#/components/parameters/PublicationId'
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
      responses:
        '200':
          description: Список комментариев
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/CommentResponse'
                  total:
                    type: integer
                    example: 15
                  limit:
                    type: integer
                    example: 20
                  offset:
                    type: integer
                    example: 0
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags: [Comments]
      summary: Создать комментарий
      description: Добавить комментарий к публикации
      parameters:
        - $ref: '#/components/parameters/PublicationId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommentRequest'
            example:
              text: "Отличная фотография!"
      responses:
        '201':
          description: Комментарий успешно создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /comment/{id}:
    get:
      tags: [Comments]
      summary: Получить комментарий
      description: Получение информации о комментарии по ID
      parameters:
        - $ref: '#/components/parameters/CommentId'
      responses:
        '200':
          description: Информация о комментарии
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Comments]
      summary: Редактировать комментарий
      description: Обновление комментария (только автор)
      parameters:
        - $ref: '#/components/parameters/CommentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
                  maxLength: 2000
                  description: Новый текст комментария
                  example: "Обновленный комментарий"
      responses:
        '200':
          description: Комментарий успешно обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Comments]
      summary: Удалить комментарий
      description: Удаление комментария (только автор)
      parameters:
        - $ref: '#/components/parameters/CommentId'
      responses:
        '204':
          description: Комментарий успешно удален
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /comment/{id}/reply:
    post:
      tags: [Comments]
      summary: Ответить на комментарий
      description: Создать ответ на существующий комментарий
      parameters:
        - $ref: '#/components/parameters/CommentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [text]
              properties:
                text:
                  type: string
                  maxLength: 2000
                  description: Текст ответа
                  example: "Согласен с вами!"
      responses:
        '201':
          description: Ответ успешно создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /comment/{id}/like:
    post:
      tags: [Comments]
      summary: Лайкнуть комментарий
      description: Поставить или убрать лайк с комментария
      parameters:
        - $ref: '#/components/parameters/CommentId'
      responses:
        '200':
          description: Лайк успешно поставлен/убран
          content:
            application/json:
              schema:
                type: object
                properties:
                  liked:
                    type: boolean
                    description: Лайкнул ли пользователь комментарий
                    example: true
                  likes_count:
                    type: integer
                    description: Общее количество лайков комментария
                    example: 4
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Лента
  /feed:
    get:
      tags: [Feed]
      summary: Получить ленту
      description: Получение основной ленты публикаций с фильтрами
      parameters:
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
        - name: type
          in: query
          description: Фильтр по типу публикации
          schema:
            $ref: '#/components/schemas/PublicationType'
        - name: visibility
          in: query
          description: Фильтр по видимости
          schema:
            $ref: '#/components/schemas/VisibilityType'
        - name: author_id
          in: query
          description: Фильтр по автору
          schema:
            type: string
            format: uuid
        - name: date_from
          in: query
          description: Фильтр по дате (от)
          schema:
            type: string
            format: date-time
        - name: date_to
          in: query
          description: Фильтр по дате (до)
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Лента публикаций
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/PublicationResponse'
                  total:
                    type: integer
                    example: 150
                  limit:
                    type: integer
                    example: 20
                  offset:
                    type: integer
                    example: 0
        '401':
          $ref: '#/components/responses/Unauthorized'

  /feed/me:
    get:
      tags: [Feed]
      summary: Мои публикации
      description: Получение публикаций текущего пользователя
      parameters:
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
        - name: type
          in: query
          description: Фильтр по типу публикации
          schema:
            $ref: '#/components/schemas/PublicationType'
        - name: visibility
          in: query
          description: Фильтр по видимости
          schema:
            $ref: '#/components/schemas/VisibilityType'
      responses:
        '200':
          description: Публикации пользователя
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/PublicationResponse'
                  total:
                    type: integer
                    example: 25
                  limit:
                    type: integer
                    example: 20
                  offset:
                    type: integer
                    example: 0
        '401':
          $ref: '#/components/responses/Unauthorized'

  /feed/me/saved:
    get:
      tags: [Feed]
      summary: Сохраненные публикации
      description: Получение публикаций, сохраненных пользователем
      parameters:
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
        - name: type
          in: query
          description: Фильтр по типу публикации
          schema:
            $ref: '#/components/schemas/PublicationType'
      responses:
        '200':
          description: Сохраненные публикации
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/PublicationResponse'
                        - type: object
                          properties:
                            saved_note:
                              type: string
                              nullable: true
                              description: Заметка пользователя к сохраненной публикации
                              example: "Интересная статья о фотографии"
                            saved_at:
                              type: string
                              format: date-time
                              description: Дата сохранения
                              example: "2024-01-15T16:30:00Z"
                  total:
                    type: integer
                    example: 12
                  limit:
                    type: integer
                    example: 20
                  offset:
                    type: integer
                    example: 0
        '401':
          $ref: '#/components/responses/Unauthorized'

  /feed/user/{id}:
    get:
      tags: [Feed]
      summary: Публикации пользователя
      description: Получение публикаций конкретного пользователя
      parameters:
        - $ref: '#/components/parameters/UserId'
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
        - name: type
          in: query
          description: Фильтр по типу публикации
          schema:
            $ref: '#/components/schemas/PublicationType'
        - name: visibility
          in: query
          description: Фильтр по видимости
          schema:
            $ref: '#/components/schemas/VisibilityType'
      responses:
        '200':
          description: Публикации пользователя
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/PublicationResponse'
                  total:
                    type: integer
                    example: 42
                  limit:
                    type: integer
                    example: 20
                  offset:
                    type: integer
                    example: 0
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Профили
  /profile/me:
    get:
      tags: [Profile]
      summary: Мой профиль
      description: Получение профиля текущего пользователя
      responses:
        '200':
          description: Профиль пользователя
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Profile]
      summary: Редактировать профиль
      description: Обновление профиля текущего пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProfileEditRequest'
            example:
              description: "Фотограф и дизайнер из Минска"
              icon_url: "https://cdn.sense.social/avatars/user123.jpg"
      responses:
        '200':
          description: Профиль успешно обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /profile/{id}:
    get:
      tags: [Profile]
      summary: Профиль пользователя
      description: Получение публичного профиля пользователя
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Профиль пользователя
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /profile/{id}/stats:
    get:
      tags: [Profile]
      summary: Статистика пользователя
      description: Получение статистики пользователя
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Статистика пользователя
          content:
            application/json:
              schema:
                type: object
                properties:
                  publications_count:
                    type: integer
                    minimum: 0
                    description: Количество публикаций
                    example: 42
                  followers_count:
                    type: integer
                    minimum: 0
                    description: Количество подписчиков
                    example: 150
                  following_count:
                    type: integer
                    minimum: 0
                    description: Количество подписок
                    example: 89
                  likes_received:
                    type: integer
                    minimum: 0
                    description: Количество полученных лайков
                    example: 1250
                  comments_received:
                    type: integer
                    minimum: 0
                    description: Количество полученных комментариев
                    example: 340
                  saved_count:
                    type: integer
                    minimum: 0
                    description: Количество сохранений публикаций
                    example: 67
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Поиск
  /search:
    get:
      tags: [Search]
      summary: Поиск публикаций
      description: Поиск публикаций по тексту и фильтрам
      parameters:
        - name: q
          in: query
          required: true
          description: Поисковый запрос
          schema:
            type: string
            minLength: 1
            maxLength: 100
          example: "фотография"
        - name: type
          in: query
          description: Фильтр по типу публикации
          schema:
            $ref: '#/components/schemas/PublicationType'
        - name: author_id
          in: query
          description: Фильтр по автору
          schema:
            type: string
            format: uuid
        - name: visibility
          in: query
          description: Фильтр по видимости
          schema:
            $ref: '#/components/schemas/VisibilityType'
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
      responses:
        '200':
          description: Результаты поиска
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /search/users:
    get:
      tags: [Search]
      summary: Поиск пользователей
      description: Поиск пользователей по имени или описанию
      parameters:
        - name: q
          in: query
          required: true
          description: Поисковый запрос
          schema:
            type: string
            minLength: 1
            maxLength: 100
          example: "john"
        - name: role
          in: query
          description: Фильтр по роли
          schema:
            $ref: '#/components/schemas/UserRole'
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
      responses:
        '200':
          description: Результаты поиска пользователей
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserProfileResponse'
                  total:
                    type: integer
                    example: 15
                  limit:
                    type: integer
                    example: 20
                  offset:
                    type: integer
                    example: 0
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /search/warmup:
    post:
      tags: [Search]
      summary: Прогрев поискового индекса
      description: Запуск процесса индексации для улучшения качества поиска
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                filters:
                  type: object
                  description: Фильтры для индексации
                  properties:
                    type:
                      $ref: '#/components/schemas/PublicationType'
                    visibility:
                      $ref: '#/components/schemas/VisibilityType'
                    date_from:
                      type: string
                      format: date-time
                    date_to:
                      type: string
                      format: date-time
      responses:
        '200':
          description: Процесс индексации запущен
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Индексация запущена"
                  task_id:
                    type: string
                    format: uuid
                    description: ID задачи индексации
                    example: "123e4567-e89b-12d3-a456-426614174000"
        '401':
          $ref: '#/components/responses/Unauthorized'

  # Медиа
  /media/upload:
    post:
      tags: [Media]
      summary: Загрузить медиа-файл
      description: Загрузка изображения или другого медиа-файла
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: Медиа-файл для загрузки
                description:
                  type: string
                  maxLength: 500
                  description: Описание медиа-файла
                  example: "Фотография заката в Минске"
      responses:
        '201':
          description: Медиа-файл успешно загружен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MediaAsset'
              example:
                id: "123e4567-e89b-12d3-a456-426614174000"
                owner_id: "123e4567-e89b-12d3-a456-426614174000"
                filename: "sunset.jpg"
                mime: "image/jpeg"
                width: 1920
                height: 1080
                created_at: "2024-01-15T10:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '413':
          description: Файл слишком большой
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "file_too_large"
                message: "Размер файла превышает максимально допустимый"
                details: "Максимальный размер файла: 10MB"

  /media/{id}:
    get:
      tags: [Media]
      summary: Получить информацию о медиа-файле
      description: Получение метаданных медиа-файла
      parameters:
        - $ref: '#/components/parameters/MediaId'
      responses:
        '200':
          description: Информация о медиа-файле
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MediaAsset'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Media]
      summary: Удалить медиа-файл
      description: Удаление медиа-файла (только владелец)
      parameters:
        - $ref: '#/components/parameters/MediaId'
      responses:
        '204':
          description: Медиа-файл успешно удален
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /media/{id}/file:
    get:
      tags: [Media]
      summary: Получить медиа-файл
      description: Получение бинарных данных медиа-файла
      parameters:
        - $ref: '#/components/parameters/MediaId'
      responses:
        '200':
          description: Бинарные данные медиа-файла
          content:
            '*/*':
              schema:
                type: string
                format: binary
          headers:
            Content-Type:
              schema:
                type: string
              description: MIME тип файла
              example: "image/jpeg"
            Content-Disposition:
              schema:
                type: string
              description: Имя файла для скачивания
              example: "attachment; filename=sunset.jpg"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # AI функции
  /recommendations:
    post:
      tags: [AI]
      summary: Получить рекомендации
      description: Получение персонализированных рекомендаций на основе AI
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                limit:
                  type: integer
                  minimum: 1
                  maximum: 50
                  default: 20
                  description: Количество рекомендаций
                  example: 20
                algorithm:
                  type: string
                  description: Предпочитаемый алгоритм рекомендаций
                  example: "collaborative_filtering"
      responses:
        '200':
          description: Персонализированные рекомендации
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/PublicationResponse'
                        - type: object
                          properties:
                            recommendation:
                              $ref: '#/components/schemas/Recommendation'
                  total:
                    type: integer
                    example: 20
        '401':
          $ref: '#/components/responses/Unauthorized'

  /recommendations/feed:
    get:
      tags: [AI]
      summary: Лента рекомендаций
      description: Получение ленты с рекомендациями
      parameters:
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
        - name: algorithm
          in: query
          description: Алгоритм рекомендаций
          schema:
            type: string
            example: "collaborative_filtering"
      responses:
        '200':
          description: Лента с рекомендациями
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/PublicationResponse'
                        - type: object
                          properties:
                            recommendation:
                              $ref: '#/components/schemas/Recommendation'
                  total:
                    type: integer
                    example: 50
                  limit:
                    type: integer
                    example: 20
                  offset:
                    type: integer
                    example: 0
        '401':
          $ref: '#/components/responses/Unauthorized'

  /recommendations/{id}/hide:
    post:
      tags: [AI]
      summary: Скрыть рекомендацию
      description: Скрыть конкретную рекомендацию от пользователя
      parameters:
        - name: id
          in: path
          required: true
          description: ID рекомендации
          schema:
            type: string
            format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Рекомендация скрыта
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Рекомендация скрыта"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /purify:
    post:
      tags: [AI]
      summary: Очистить текст
      description: Очистка и модерация текста через AI
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PurifyRequest'
            example:
              text: "Этот текст содержит нецензурную лексику"
      responses:
        '200':
          description: Текст успешно обработан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PurifyResponse'
              example:
                cleaned_text: "Этот текст содержит [цензура] лексику"
                is_clean: false
                confidence: 0.95
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # Дополнительные эндпоинты для расширенной функциональности
  /follow/{id}:
    post:
      tags: [Profile]
      summary: Подписаться на пользователя
      description: Подписаться на другого пользователя
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '201':
          description: Успешно подписались
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Вы подписались на пользователя"
        '400':
          description: Нельзя подписаться на себя
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Profile]
      summary: Отписаться от пользователя
      description: Отписаться от пользователя
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '204':
          description: Успешно отписались
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /notifications:
    get:
      tags: [Profile]
      summary: Получить уведомления
      description: Получение уведомлений пользователя
      parameters:
        - $ref: '#/components/parameters/PaginationLimit'
        - $ref: '#/components/parameters/PaginationOffset'
        - name: unread_only
          in: query
          description: Только непрочитанные уведомления
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Список уведомлений
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        type:
                          type: string
                          example: "like"
                        title:
                          type: string
                          example: "Новый лайк"
                        message:
                          type: string
                          example: "Пользователь поставил лайк вашей публикации"
                        is_read:
                          type: boolean
                        created_at:
                          type: string
                          format: date-time
                  total:
                    type: integer
                  limit:
                    type: integer
                  offset:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'

  /tags:
    get:
      tags: [Search]
      summary: Получить популярные теги
      description: Получение списка популярных тегов
      parameters:
        - name: limit
          in: query
          description: Количество тегов
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: search
          in: query
          description: Поиск по названию тега
          schema:
            type: string
      responses:
        '200':
          description: Список тегов
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        name:
                          type: string
                          example: "фотография"
                        description:
                          type: string
                          example: "Тег для публикаций о фотографии"
                        usage_count:
                          type: integer
                          example: 150
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации. Получить токен можно через /auth/login или /auth/register

  schemas:
    # Enum типы
    UserRole:
      type: string
      enum: [reader, user, creator, expert, super]
      description: Роль пользователя в системе
      example: "user"

    PublicationType:
      type: string
      enum: [quote, post, article]
      description: Тип публикации
      example: "post"

    VisibilityType:
      type: string
      enum: [public, community, private]
      description: Уровень видимости публикации
      example: "public"

    # Основные модели данных
    User:
      type: object
      required: [id, username, role, registered_at]
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор пользователя
          example: "123e4567-e89b-12d3-a456-426614174000"
        username:
          type: string
          description: Имя пользователя (уникальное)
          example: "john_doe"
        email:
          type: string
          format: email
          description: Email адрес пользователя
          example: "john@example.com"
        phone:
          type: string
          description: Номер телефона пользователя
          example: "+375291234567"
        icon_url:
          type: string
          format: uri
          description: URL аватара пользователя
          example: "https://cdn.sense.social/avatars/user123.jpg"
        description:
          type: string
          description: Описание/биография пользователя
          example: "Фотограф и дизайнер из Минска"
        role:
          $ref: '#/components/schemas/UserRole'
        registered_at:
          type: string
          format: date-time
          description: Дата регистрации
          example: "2024-01-15T10:30:00Z"
        statistic:
          type: object
          description: Статистика пользователя
          properties:
            publications_count:
              type: integer
              minimum: 0
              example: 42
            followers_count:
              type: integer
              minimum: 0
              example: 150
            following_count:
              type: integer
              minimum: 0
              example: 89
            likes_received:
              type: integer
              minimum: 0
              example: 1250

    Publication:
      type: object
      required: [id, author_id, type, publication_date, visibility]
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор публикации
          example: "123e4567-e89b-12d3-a456-426614174000"
        author_id:
          type: string
          format: uuid
          description: ID автора публикации
          example: "123e4567-e89b-12d3-a456-426614174000"
        type:
          $ref: '#/components/schemas/PublicationType'
        content:
          type: string
          description: Основной контент публикации
          example: "Сегодня был прекрасный закат в Минске!"
        source:
          type: string
          description: Источник для цитат
          example: "Альберт Эйнштейн"
        publication_date:
          type: string
          format: date-time
          description: Дата публикации
          example: "2024-01-15T14:30:00Z"
        visibility:
          $ref: '#/components/schemas/VisibilityType'
        likes_count:
          type: integer
          minimum: 0
          description: Количество лайков
          example: 25
        comments_count:
          type: integer
          minimum: 0
          description: Количество комментариев
          example: 8
        saved_count:
          type: integer
          minimum: 0
          description: Количество сохранений
          example: 12

    Comment:
      type: object
      required: [id, publication_id, author_id, text, created_at]
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор комментария
          example: "123e4567-e89b-12d3-a456-426614174000"
        publication_id:
          type: string
          format: uuid
          description: ID публикации
          example: "123e4567-e89b-12d3-a456-426614174000"
        parent_id:
          type: string
          format: uuid
          nullable: true
          description: ID родительского комментария (для ответов)
          example: "123e4567-e89b-12d3-a456-426614174000"
        author_id:
          type: string
          format: uuid
          description: ID автора комментария
          example: "123e4567-e89b-12d3-a456-426614174000"
        text:
          type: string
          description: Текст комментария
          example: "Отличная фотография!"
        created_at:
          type: string
          format: date-time
          description: Дата создания комментария
          example: "2024-01-15T15:30:00Z"
        likes_count:
          type: integer
          minimum: 0
          description: Количество лайков комментария
          example: 3

    MediaAsset:
      type: object
      required: [id, owner_id, mime, created_at]
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор медиа-файла
          example: "123e4567-e89b-12d3-a456-426614174000"
        owner_id:
          type: string
          format: uuid
          description: ID владельца медиа-файла
          example: "123e4567-e89b-12d3-a456-426614174000"
        filename:
          type: string
          nullable: true
          description: Оригинальное имя файла
          example: "sunset.jpg"
        mime:
          type: string
          description: MIME тип файла
          example: "image/jpeg"
        width:
          type: integer
          minimum: 0
          nullable: true
          description: Ширина изображения в пикселях
          example: 1920
        height:
          type: integer
          minimum: 0
          nullable: true
          description: Высота изображения в пикселях
          example: 1080
        exif:
          type: object
          nullable: true
          description: EXIF данные изображения
          example:
            camera: "Canon EOS R5"
            lens: "RF 24-70mm f/2.8L IS USM"
            iso: 400
            aperture: "f/2.8"
            shutter_speed: "1/125"
        created_at:
          type: string
          format: date-time
          description: Дата загрузки файла
          example: "2024-01-15T10:30:00Z"

    SavedItem:
      type: object
      required: [id, user_id, publication_id, added_at]
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор сохранения
          example: "123e4567-e89b-12d3-a456-426614174000"
        user_id:
          type: string
          format: uuid
          description: ID пользователя
          example: "123e4567-e89b-12d3-a456-426614174000"
        publication_id:
          type: string
          format: uuid
          description: ID публикации
          example: "123e4567-e89b-12d3-a456-426614174000"
        added_at:
          type: string
          format: date-time
          description: Дата добавления в сохраненные
          example: "2024-01-15T16:30:00Z"
        note:
          type: string
          nullable: true
          description: Заметка пользователя к сохраненной публикации
          example: "Интересная статья о фотографии"

    Recommendation:
      type: object
      required: [id, user_id, publication_id, algorithm, reason, rank, created_at]
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор рекомендации
          example: "123e4567-e89b-12d3-a456-426614174000"
        user_id:
          type: string
          format: uuid
          description: ID пользователя
          example: "123e4567-e89b-12d3-a456-426614174000"
        publication_id:
          type: string
          format: uuid
          description: ID рекомендуемой публикации
          example: "123e4567-e89b-12d3-a456-426614174000"
        algorithm:
          type: string
          description: Алгоритм, который сгенерировал рекомендацию
          example: "collaborative_filtering"
        reason:
          type: string
          description: Объяснение рекомендации
          example: "Похожие пользователи тоже лайкнули эту публикацию"
        rank:
          type: integer
          minimum: 0
          description: Ранг рекомендации (чем меньше, тем выше приоритет)
          example: 1
        created_at:
          type: string
          format: date-time
          description: Дата создания рекомендации
          example: "2024-01-15T12:00:00Z"
        hidden:
          type: boolean
          description: Скрыта ли рекомендация пользователем
          example: false

    # DTO модели для запросов и ответов
    LoginRequest:
      type: object
      required: [login, password]
      properties:
        login:
          type: string
          description: Имя пользователя или email
          example: "john_doe"
        password:
          type: string
          format: password
          description: Пароль пользователя
          example: "secure_password123"

    RegisterRequest:
      type: object
      required: [username, email, password]
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 30
          pattern: "^[a-zA-Z0-9_]+$"
          description: Имя пользователя (только латинские буквы, цифры и _)
          example: "john_doe"
        email:
          type: string
          format: email
          description: Email адрес
          example: "john@example.com"
        password:
          type: string
          format: password
          minLength: 8
          description: Пароль (минимум 8 символов)
          example: "secure_password123"
        phone:
          type: string
          nullable: true
          description: Номер телефона
          example: "+375291234567"
        description:
          type: string
          maxLength: 500
          nullable: true
          description: Описание профиля
          example: "Фотограф и дизайнер"

    SessionResponse:
      type: object
      required: [access_token, token_type, expires_in, user]
      properties:
        access_token:
          type: string
          description: JWT токен доступа
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        token_type:
          type: string
          enum: [Bearer]
          description: Тип токена
          example: "Bearer"
        expires_in:
          type: integer
          description: Время жизни токена в секундах
          example: 3600
        user:
          $ref: '#/components/schemas/User'

    CreatePublicationRequest:
      type: object
      required: [type, content, visibility]
      properties:
        type:
          $ref: '#/components/schemas/PublicationType'
        content:
          type: string
          maxLength: 10000
          description: Основной контент публикации
          example: "Сегодня был прекрасный закат в Минске!"
        source:
          type: string
          maxLength: 200
          nullable: true
          description: Источник для цитат
          example: "Альберт Эйнштейн"
        visibility:
          $ref: '#/components/schemas/VisibilityType'
        media_ids:
          type: array
          items:
            type: string
            format: uuid
          description: Список ID медиа-файлов для прикрепления
          example: ["123e4567-e89b-12d3-a456-426614174000"]

    UpdatePublicationRequest:
      type: object
      properties:
        content:
          type: string
          maxLength: 10000
          description: Основной контент публикации
          example: "Обновленный текст публикации"
        source:
          type: string
          maxLength: 200
          nullable: true
          description: Источник для цитат
          example: "Альберт Эйнштейн"
        visibility:
          $ref: '#/components/schemas/VisibilityType'
        media_ids:
          type: array
          items:
            type: string
            format: uuid
          description: Список ID медиа-файлов для прикрепления
          example: ["123e4567-e89b-12d3-a456-426614174000"]

    PublicationResponse:
      allOf:
        - $ref: '#/components/schemas/Publication'
        - type: object
          properties:
            author:
              $ref: '#/components/schemas/User'
            media:
              type: array
              items:
                $ref: '#/components/schemas/MediaAsset'
            is_liked:
              type: boolean
              description: Лайкнул ли текущий пользователь эту публикацию
              example: true
            is_saved:
              type: boolean
              description: Сохранил ли текущий пользователь эту публикацию
              example: false

    CreateCommentRequest:
      type: object
      required: [text]
      properties:
        text:
          type: string
          maxLength: 2000
          description: Текст комментария
          example: "Отличная фотография!"
        parent_id:
          type: string
          format: uuid
          nullable: true
          description: ID родительского комментария (для ответов)
          example: "123e4567-e89b-12d3-a456-426614174000"

    CommentResponse:
      allOf:
        - $ref: '#/components/schemas/Comment'
        - type: object
          properties:
            author:
              $ref: '#/components/schemas/User'
            is_liked:
              type: boolean
              description: Лайкнул ли текущий пользователь этот комментарий
              example: false

    ProfileEditRequest:
      type: object
      properties:
        description:
          type: string
          maxLength: 500
          nullable: true
          description: Описание профиля
          example: "Фотограф и дизайнер из Минска"
        icon_url:
          type: string
          format: uri
          nullable: true
          description: URL аватара
          example: "https://cdn.sense.social/avatars/user123.jpg"

    UserProfileResponse:
      allOf:
        - $ref: '#/components/schemas/User'
        - type: object
          properties:
            is_following:
              type: boolean
              description: Подписан ли текущий пользователь на этого пользователя
              example: true

    SearchRequest:
      type: object
      required: [query]
      properties:
        query:
          type: string
          minLength: 1
          maxLength: 100
          description: Поисковый запрос
          example: "фотография"
        type:
          $ref: '#/components/schemas/PublicationType'
        author_id:
          type: string
          format: uuid
          description: Фильтр по автору
          example: "123e4567-e89b-12d3-a456-426614174000"
        visibility:
          $ref: '#/components/schemas/VisibilityType'

    SearchResponse:
      type: object
      required: [items, total, limit, offset]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PublicationResponse'
        total:
          type: integer
          minimum: 0
          description: Общее количество найденных элементов
          example: 42
        limit:
          type: integer
          minimum: 1
          maximum: 100
          description: Количество элементов на странице
          example: 20
        offset:
          type: integer
          minimum: 0
          description: Смещение для пагинации
          example: 0

    FeedFilters:
      type: object
      properties:
        type:
          $ref: '#/components/schemas/PublicationType'
        visibility:
          $ref: '#/components/schemas/VisibilityType'
        author_id:
          type: string
          format: uuid
          description: Фильтр по автору
          example: "123e4567-e89b-12d3-a456-426614174000"
        date_from:
          type: string
          format: date-time
          description: Фильтр по дате (от)
          example: "2024-01-01T00:00:00Z"
        date_to:
          type: string
          format: date-time
          description: Фильтр по дате (до)
          example: "2024-12-31T23:59:59Z"

    PurifyRequest:
      type: object
      required: [text]
      properties:
        text:
          type: string
          maxLength: 10000
          description: Текст для очистки/модерации
          example: "Этот текст содержит нецензурную лексику"

    PurifyResponse:
      type: object
      required: [cleaned_text, is_clean]
      properties:
        cleaned_text:
          type: string
          description: Очищенный текст
          example: "Этот текст содержит [цензура] лексику"
        is_clean:
          type: boolean
          description: Был ли текст изначально чистым
          example: false
        confidence:
          type: number
          minimum: 0
          maximum: 1
          description: Уверенность в результате модерации
          example: 0.95

    ErrorResponse:
      type: object
      required: [error, message]
      properties:
        error:
          type: string
          description: Код ошибки
          example: "validation_error"
        message:
          type: string
          description: Сообщение об ошибке
          example: "Неверные данные в запросе"
        details:
          type: string
          nullable: true
          description: Детали ошибки
          example: "Поле 'email' должно быть валидным email адресом"

  parameters:
    PaginationLimit:
      name: limit
      in: query
      description: Количество элементов на странице
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      example: 20

    PaginationOffset:
      name: offset
      in: query
      description: Смещение для пагинации
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      example: 0

    PublicationId:
      name: id
      in: path
      description: Уникальный идентификатор публикации
      required: true
      schema:
        type: string
        format: uuid
      example: "123e4567-e89b-12d3-a456-426614174000"

    UserId:
      name: id
      in: path
      description: Уникальный идентификатор пользователя
      required: true
      schema:
        type: string
        format: uuid
      example: "123e4567-e89b-12d3-a456-426614174000"

    CommentId:
      name: id
      in: path
      description: Уникальный идентификатор комментария
      required: true
      schema:
        type: string
        format: uuid
      example: "123e4567-e89b-12d3-a456-426614174000"

    MediaId:
      name: id
      in: path
      description: Уникальный идентификатор медиа-файла
      required: true
      schema:
        type: string
        format: uuid
      example: "123e4567-e89b-12d3-a456-426614174000"

  responses:
    BadRequest:
      description: Неверный запрос
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "validation_error"
            message: "Неверные данные в запросе"
            details: "Поле 'email' должно быть валидным email адресом"

    Unauthorized:
      description: Не авторизован
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "unauthorized"
            message: "Требуется аутентификация"
            details: "JWT токен отсутствует или недействителен"

    Forbidden:
      description: Доступ запрещен
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "forbidden"
            message: "Недостаточно прав для выполнения операции"
            details: "Вы можете редактировать только свои публикации"

    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "not_found"
            message: "Ресурс не найден"
            details: "Публикация с указанным ID не существует"

    InternalServerError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "internal_error"
            message: "Внутренняя ошибка сервера"
            details: "Попробуйте повторить запрос позже"

security:
  - bearerAuth: []
